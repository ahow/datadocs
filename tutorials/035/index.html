<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width initial-scale=1">

  <title>Adding a new scraper (2)</title>
  <meta name="description" content="Adding a new scraper (2)">

  <link href="https://ahow.github.io/datadocs/css/main.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="https://ahow.github.io/datadocs/css/custom.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link rel="canonical" href="https://ahow.github.io/datadocs/datadocs/tutorials/035/">
  <link rel="alternate" type="application/atom+xml" title="Andrew Howard - slide show" href="https://ahow.github.io/feed.xml"/>
  <link rel="shortcut icon" type="image/png" href="https://ahow.github.io/favicon.png">
</head>

  <body class=>

    <main class="wrap">
      <div class="main-content">
        <div class="section-default section-tuts">
	<div class="row">
		<div class="small-12 medium-4 large-3 columns">
			<div class="tutorials-sidebar">
				<h3>Contents</h3>
				

				

				<ul class="tutorial-nav">
					
					<li >
						<a href="https://ahow.github.io/datadocs/topic/001/">General Overview</a>
						<ul class="tutorial-sub-nav">
							
							
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/002/">General Overview</a>
							</li>
							
						</ul>
					</li>
					
					<li >
						<a href="https://ahow.github.io/datadocs/topic/003/">Empty the database</a>
						<ul class="tutorial-sub-nav">
							
							
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/004/">Empty the database</a>
							</li>
							
						</ul>
					</li>
					
					<li >
						<a href="https://ahow.github.io/datadocs/topic/005/">Importing files</a>
						<ul class="tutorial-sub-nav">
							
							
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/006/">Input: Import inputfiles</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/007/">Import companies</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/008/">Import companies: Results</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/009/">Importing data using the inputfile</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/010/">Import Invest IQ Files</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/011/">Import Invest IQ Files (2)</a>
							</li>
							
						</ul>
					</li>
					
					<li >
						<a href="https://ahow.github.io/datadocs/topic/012/">Data already imported in the database</a>
						<ul class="tutorial-sub-nav">
							
							
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/013/">Tables already in database</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/014/">Input: Import from Database Tables</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/015/">Input: Import from Database Tables</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/016/">Input: Import from Database Tables</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/017/">Input: Import from Database Tables</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/018/">Input: Import from Database Tables</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/019/">Input: Import from Database Tables</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/020/">Input: Config</a>
							</li>
							
						</ul>
					</li>
					
					<li >
						<a href="https://ahow.github.io/datadocs/topic/021/">Create an inputfile</a>
						<ul class="tutorial-sub-nav">
							
							
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/022/">Create input file</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/023/">Create input file: Run scrapers</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/024/">Create input file: Edit outputfile</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/025/">Create input file: Edit outputfile (2)</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/026/">Create input file: Create inputfile</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/027/">Create input file: Create inputfile (2)</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/028/">Create input file: Create inputfile (3)</a>
							</li>
							
						</ul>
					</li>
					
					<li >
						<a href="https://ahow.github.io/datadocs/topic/029/">Fuzzy matching process</a>
						<ul class="tutorial-sub-nav">
							
							
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/030/">Fuzzy-matching</a>
							</li>
							
						</ul>
					</li>
					
					<li >
						<a href="https://ahow.github.io/datadocs/topic/031/">Delete/Add/Edit Scrapers</a>
						<ul class="tutorial-sub-nav">
							
							
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/032/">Deleting a scraper</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/033/">Making a scraper obsolete</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/034/">Adding a new scraper (1)</a>
							</li>
							
							<li  class="active" >
								<a href="https://ahow.github.io/datadocs/tutorials/035/">Adding a new scraper (2)</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/036/">Adding a new scraper (3)</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/037/">Adding a new scraper (4)</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/038/">Adding a new scraper (5)</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/039/">Adding a new scraper (6)</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/040/">Adding a new scraper (7)</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/041/">Using the new scraper in the metrics table</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/042/">Create a record based on historic data</a>
							</li>
							
						</ul>
					</li>
					
					<li >
						<a href="https://ahow.github.io/datadocs/topic/043/">Delete/Add/Edit BBG/DS-datapoints</a>
						<ul class="tutorial-sub-nav">
							
							
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/044/">Adding a new datapoint from BBG/DS</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/045/">Adding a new datapoint in input</a>
							</li>
							
						</ul>
					</li>
					
					<li >
						<a href="https://ahow.github.io/datadocs/topic/046/">Delete/Add/Edit Metrics</a>
						<ul class="tutorial-sub-nav">
							
							
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/047/">Adding a new metrics</a>
							</li>
							
						</ul>
					</li>
					
					<li >
						<a href="https://ahow.github.io/datadocs/topic/048/">Creating a new metric-formula-type</a>
						<ul class="tutorial-sub-nav">
							
							
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/049/">Creating a new metric-formula-type</a>
							</li>
							
						</ul>
					</li>
					
					<li >
						<a href="https://ahow.github.io/datadocs/topic/050/">Normal run</a>
						<ul class="tutorial-sub-nav">
							
							
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/051/">Normal run</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/052/">Python processing</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/053/">Export</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/054/">Selection of the outputvariables</a>
							</li>
							
						</ul>
					</li>
					
					<li >
						<a href="https://ahow.github.io/datadocs/topic/055/">Follow-up of the normal run</a>
						<ul class="tutorial-sub-nav">
							
							
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/056/">Selection of the outputvariables</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/057/">Uploaded files</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/058/">Output files</a>
							</li>
							
						</ul>
					</li>
					
					<li >
						<a href="https://ahow.github.io/datadocs/topic/059/">Export</a>
						<ul class="tutorial-sub-nav">
							
							
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/060/">Different methods to export data</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/061/">http://scrapecalctool.scibizinformatics.com/output/</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/062/">Method 5: Using Metrics calculations results</a>
							</li>
							
						</ul>
					</li>
					
					<li >
						<a href="https://ahow.github.io/datadocs/topic/063/">Running parts of the run</a>
						<ul class="tutorial-sub-nav">
							
							
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/064/">Normal Run</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/065/">Manual Running of parts of the script</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/066/">Manual Running of parts of the script</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/067/">Manual Running of parts of the script</a>
							</li>
							
						</ul>
					</li>
					
					<li >
						<a href="https://ahow.github.io/datadocs/topic/068/">After the Export</a>
						<ul class="tutorial-sub-nav">
							
							
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/069/">After using the export-action</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/070/">Redirect to selection screen</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/071/">After using the export-action</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/072/">After the export: health check</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/073/">After the export: health check</a>
							</li>
							
						</ul>
					</li>
					
					<li >
						<a href="https://ahow.github.io/datadocs/topic/074/">Special cases</a>
						<ul class="tutorial-sub-nav">
							
							
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/075/">RTB</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/076/">EICC/EITI Change</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/077/">EICC/EITI Change (2)</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/078/">EICC/EITI Change (3)</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/079/">Input: using fuzzy string comparison </a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/080/">Input: using fuzzy string comparison</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/081/">Input: using fuzzy string comparison </a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/082/">Input: using fuzzy string comparison </a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/083/">Input: using fuzzy string comparison </a>
							</li>
							
						</ul>
					</li>
					
					<li >
						<a href="https://ahow.github.io/datadocs/topic/084/">Run specific scrapers</a>
						<ul class="tutorial-sub-nav">
							
							
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/085/">Obsolete scrapers: Scraper scripts</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/086/">Select which scrapers will run Using Scraper scripts </a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/087/">Select which scrapers will run Using Scraper variables</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/088/">Select which scrapers will run Using Scraper variables</a>
							</li>
							
						</ul>
					</li>
					
					<li >
						<a href="https://ahow.github.io/datadocs/topic/089/">Create a scraper-output-variable that is dependent on other scraper-output-variables</a>
						<ul class="tutorial-sub-nav">
							
							
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/090/">Running a scraper based on other scrapers</a>
							</li>
							
						</ul>
					</li>
					
					<li >
						<a href="https://ahow.github.io/datadocs/topic/091/">Fuzzy matching for EITI/EICC-tables</a>
						<ul class="tutorial-sub-nav">
							
							
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/092/">Fill company name and isin code using fuzzy comparison</a>
							</li>
							
						</ul>
					</li>
					
					<li >
						<a href="https://ahow.github.io/datadocs/topic/093/">Create new EITI/EICC-tables</a>
						<ul class="tutorial-sub-nav">
							
							
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/094/">Create a scraper like EICC (step 1)</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/095/">Create a scraper like EICC (step 2)</a>
							</li>
							
						</ul>
					</li>
					
					<li >
						<a href="https://ahow.github.io/datadocs/topic/096/">Create datapoints based on the (isin) or (isin + year)-combinations</a>
						<ul class="tutorial-sub-nav">
							
							
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/097/">DP not based on scrapers and not based on BBG/DS</a>
							</li>
							
						</ul>
					</li>
					
					<li >
						<a href="https://ahow.github.io/datadocs/topic/098/">Kill a job</a>
						<ul class="tutorial-sub-nav">
							
							
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/099/">Kill a job</a>
							</li>
							
						</ul>
					</li>
					
					<li >
						<a href="https://ahow.github.io/datadocs/topic/100/">Cultural analysis</a>
						<ul class="tutorial-sub-nav">
							
							
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/101/">Steps of cultural analysis</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/102/">Step 1: scraping input</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/103/">Step 1: Start Scraping GD</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/104/">Step 1: Start Scraping Seeking Alpha</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/105/">Step 1: Output GD</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/106/">Step 1: Output Seeking Alpha</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/107/">Step 2: Preparing Cultural Analysis</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/108/">Step 2: run analysis</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/109/">Step 2: output</a>
							</li>
							
							<li >
								<a href="https://ahow.github.io/datadocs/tutorials/110/">Step 2: export output</a>
							</li>
							
						</ul>
					</li>
					
				</ul>
			</div>

		</div>
		<div class="small-12 offset-large-1 large-8 medium-8 columns">
			<div class="tutorial-content">
				<h4>Adding a new scraper (2)</h4>

<up>
	<li>1.1. Add a script</li>
	<img src="https://ahow.github.io/datadocs/images/035.png" alt="">
</ul>

<p>In order to add a new scraper, you need to do the following:  
	<ul>
		<li>Add a script in the <a href="http://scrapecalctool.scibizinformatics.com/admin/base/admin_scripts/">Scraper scripts</a>-table</li>
		<li>In spyder (part of anaconda-program) or notepad or any other editor,  you make a new file and copy this:

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="s">"""
v 1.000.000: created
Purpose: get output from CSR
"""</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">requests.packages.urllib3.util.retry</span> <span class="kn">import</span> <span class="n">Retry</span>
<span class="kn">from</span> <span class="nn">requests.adapters</span> <span class="kn">import</span> <span class="n">HTTPAdapter</span>
<span class="kn">from</span> <span class="nn">base.models</span> <span class="kn">import</span> <span class="n">Company_Input</span><span class="p">,</span> <span class="n">Admin_File</span>
<span class="kn">import</span> <span class="nn">os</span> 
<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span> 
<span class="n">s</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
<span class="n">retries</span> <span class="o">=</span> <span class="n">Retry</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                <span class="n">backoff_factor</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                <span class="n">status_forcelist</span><span class="o">=</span><span class="p">[</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">502</span><span class="p">,</span> <span class="mi">503</span><span class="p">,</span> <span class="mi">504</span> <span class="p">])</span>
<span class="n">s</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s">'http://'</span><span class="p">,</span> <span class="n">HTTPAdapter</span><span class="p">(</span><span class="n">max_retries</span><span class="o">=</span><span class="n">retries</span><span class="p">))</span> 
<span class="n">base_path</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">BASE_DIR</span>
<span class="n">parent_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">base_path</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">output_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parent_dir</span><span class="p">,</span> <span class="s">'output'</span><span class="p">)</span>
<span class="n">CSR_USER</span>     <span class="o">=</span> <span class="s">"ahow"</span>
<span class="n">CSR_PASSWORD</span> <span class="o">=</span> <span class="err">“</span><span class="o">*****</span><span class="s">"</span><span class="err">
</span><span class="s">class CSR_Scraper(object):</span><span class="err">
</span><span class="s">    </span><span class="err">
</span><span class="s">    def __init__(self):</span><span class="err">
</span><span class="s">        pass</span><span class="err">
</span><span class="s">    </span><span class="err">
</span><span class="s">    def scrape_CSR(self, CSR_Company_Name, task_id, log_file, teller):</span></code></pre></figure>

		</li>

		<li>First lines are comments to indicate the version + the purpose of the program. Not really required.</li>
		<li>Then some necessary libraries are imported. Some libraries can be removed, others might need to be added. This is required for all the scrapers. </li>
		<li>Then some variables are defined (general ones for retrying if the target-website is temporarily down, then the program retries (10 times in this case, each time, it waits a bit longer (twice as long as when it failed) and local ones. This is recommended for all the scrapers. </li>
		<li>Then the class name is defined (class  CSR_Scraper()). This is required.  </li>
		<li>Def Init is required for all the scrapers (else you can’t call it)</li>
		<li>Then a function is defined. This is required. </li>
		<li>The parameters of the functions are (self: required, the input-variables: required (number of input-variables will vary per scraper), task_id, log_file, teller). These last 3 are needed for error-logging and are required, else the main program will fail on this. </li>
	</ul>
</p>

				<!-- Pagination links -->
<div class="pagination">
	<div class="row">
		<div class="small-6 pagination-prev">
			
			
			<a href="https://ahow.github.io/datadocs/tutorials/034/" class="previous">
				<svg xmlns="http://www.w3.org/2000/svg" width="12" height="8">
					<g fill="none" fill-rule="evenodd" stroke="#1FC1C4" stroke-width="2">
						<path stroke-linecap="square" d="M11 4H3.429"/>
						<path d="M5 6.828L2.172 4 5 1.172"/>
					</g>
				</svg>
				Previous
			</a>
			
		</div>
		<div class="small-6 pagination-next">

			
			<a href="https://ahow.github.io/datadocs/tutorials/036/" class="next">
				Next
				<svg xmlns="http://www.w3.org/2000/svg" width="12" height="8">
					<g fill="none" fill-rule="evenodd" stroke="#1FC1C4" stroke-width="2">
						<path stroke-linecap="square" d="M1 4h7.571"/><path d="M7 6.828L9.828 4 7 1.172"/>
					</g>
				</svg>
			</a>
			
		</div>
	</div>
</div>


<!-- /Pagination links -->
			</div>
		</div>
	</div>
</div>

      </div>

      <footer class="site-footer">
		<div class="small-12 columns">
			<span class="darkgray">© 2018 Andrew Howard</span>
		</div>
</footer>

    </main>
  </body>
</html>
